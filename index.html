<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="API密钥批量检测工具 - 快速检测多个API密钥的有效性">
    <title>API密钥批量检测工具</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Manrope:wght@400;600&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
    <style>
        /* 设计系统变量 - 天蓝配色方案 */
        :root {
            /* 主色调 - 60% */
            --primary-color: #2B95EC;
            --primary-light: #5EAFEF;
            --primary-dark: #1A7BC8;
            --primary-gradient: linear-gradient(135deg, #2B95EC, #65B5FF);
            
            /* 辅助色 - 30% */
            --secondary-color: #0E65A5;
            --secondary-light: #3A8BC2;
            --secondary-dark: #094C7E;
            
            /* 强调色 - 10% */
            --accent-color: #6FDEFF;
            --accent-light: #9DEDFF;
            --accent-dark: #3CCEFF;
            
            /* 成功/错误状态色 */
            --success-color: #2EE0A0;
            --error-color: #FF6B6B;
            --warning-color: #FFBE3D;
            
            /* 中性色调 */
            --background-color: #F0F8FF;
            --surface-color: rgba(255, 255, 255, 0.85);
            --text-primary: #14253A;
            --text-secondary: #516583;
            
            /* 阴影和效果 */
            --card-shadow-sm: 0 4px 12px rgba(43, 149, 236, 0.1);
            --card-shadow: 0 8px 20px rgba(43, 149, 236, 0.15);
            --card-shadow-lg: 0 12px 28px rgba(43, 149, 236, 0.18);
            --glassmorphism: rgba(255, 255, 255, 0.65);
            --blur-effect: 15px;
            
            /* 尺寸和间距 */
            --border-radius-sm: 0.5rem;
            --border-radius: 1rem;
            --border-radius-lg: 1.5rem;
            --transition-speed: 400ms;
            
            /* 字体 */
            --font-primary: 'Inter', system-ui, sans-serif;
            --font-secondary: 'Manrope', sans-serif;
        }

        /* 基础样式 */
        body {
            background: linear-gradient(135deg, #E9F6FF, #F0F8FF);
            font-family: var(--font-primary);
            line-height: 1.8;
            color: var(--text-primary);
            position: relative;
            overflow-x: hidden;
            min-height: 100vh;
        }

        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Cpath fill='%234A90E2' fill-opacity='0.03' d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z'%3E%3C/path%3E%3C/svg%3E");
            z-index: -1;
        }

        /* 玻璃拟态效果容器 */
        .main-container {
            max-width: clamp(300px, 90%, 1400px);
            margin: 3rem auto;
            padding: clamp(1.5rem, 5vw, 2.5rem);
            background: var(--glassmorphism);
            backdrop-filter: blur(var(--blur-effect));
            border-radius: var(--border-radius-lg);
            box-shadow: var(--card-shadow);
            border: 1px solid rgba(255, 255, 255, 0.4);
            position: relative;
            z-index: 1;
            overflow: hidden;
        }

        .main-container::before {
            content: '';
            position: absolute;
            height: 100%;
            width: 100%;
            top: 0;
            left: 0;
            background: radial-gradient(circle at top right, rgba(110, 213, 255, 0.12), transparent 70%),
                         radial-gradient(circle at bottom left, rgba(43, 149, 236, 0.12), transparent 70%);
            z-index: -1;
        }

        /* 标题区域动态SVG路径动画 */
        .header {
            text-align: center;
            margin-bottom: 2.5rem;
            padding: clamp(2rem, 4vw, 3rem);
            border-radius: var(--border-radius);
            position: relative;
            overflow: hidden;
            background: var(--primary-gradient);
            box-shadow: var(--card-shadow);
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1;
            min-height: 180px;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            opacity: 0.1;
            z-index: -1;
        }

        .svg-container {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 0;
            overflow: hidden;
        }

        .header-svg-path {
            stroke-dasharray: 1000;
            stroke-dashoffset: 1000;
            animation: drawPath 15s ease-in-out infinite alternate;
            opacity: 0.25;
        }

        @keyframes drawPath {
            0% {
                stroke-dashoffset: 1000;
            }
            40% {
                stroke-dashoffset: 0;
            }
            60% {
                stroke-dashoffset: 0;
            }
            100% {
                stroke-dashoffset: -1000;
            }
        }

        .header h1 {
            font-family: var(--font-secondary);
            font-weight: 600;
            font-size: clamp(1.8rem, 5vw, 2.5rem);
            letter-spacing: -0.03em;
            margin-bottom: 0.8rem;
            position: relative;
            z-index: 2;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .header p {
            font-size: clamp(1rem, 2vw, 1.2rem);
            opacity: 0.9;
            max-width: 80%;
            margin: 0 auto;
            position: relative;
            z-index: 2;
        }

        /* 统计卡片区 */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2.5rem;
        }

        .stat-card {
            background: var(--surface-color);
            padding: clamp(1.2rem, 3vw, 1.8rem);
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow-sm);
            transition: all var(--transition-speed) cubic-bezier(0.34, 1.56, 0.64, 1);
            border: 1px solid rgba(255, 255, 255, 0.6);
            position: relative;
            overflow: hidden;
            transform-origin: center bottom;
        }

        .stat-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: var(--card-shadow-lg);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--primary-gradient);
        }

        .stat-card h5 {
            font-family: var(--font-secondary);
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 0.8rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.95rem;
        }

        .stat-card h3 {
            font-family: var(--font-secondary);
            font-weight: 600;
            font-size: clamp(1.5rem, 4vw, 2rem);
            margin: 0;
            color: var(--primary-dark);
        }

        .stat-card i {
            font-size: 1.2rem;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* 输入区域样式 */
        .input-group {
            margin-bottom: 1.5rem;
            box-shadow: var(--card-shadow-sm);
            border-radius: var(--border-radius);
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.6);
        }
        .form-control {
            background: var(--surface-color);
            border: none;
            padding: 1.2rem;
            font-family: var(--font-primary);
            color: var(--text-primary);
            transition: all var(--transition-speed);
            line-height: 1.6;
            resize: vertical;
            box-sizing: border-box;
            padding: 1.5rem;
            padding-bottom: 2rem;
            overflow-y: auto;
        }

        .form-control:focus {
            box-shadow: inset 0 0 0 2px var(--primary-light);
            background: white;
            border-radius: inherit;
            outline: none;
        }

        .file-upload-btn {
            background: var(--secondary-color);
            color: white;
            border: none;
            padding: 0.75rem 1.2rem;
            transition: all var(--transition-speed);
        }

        .file-upload-btn:hover {
            background: var(--secondary-light);
            transform: translateY(-2px);
        }

        /* 按钮样式升级 */
        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: clamp(0.8rem, 2vw, 1.2rem);
            margin: 1.8rem 0;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: var(--border-radius);
            font-family: var(--font-primary);
            font-weight: 500;
            font-size: 0.95rem;
            letter-spacing: 0.01em;
            transition: all var(--transition-speed) cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.04), 0 2px 4px rgba(43, 149, 236, 0.08);
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(rgba(255,255,255,0.1), rgba(255,255,255,0));
            opacity: 0;
            transition: opacity var(--transition-speed);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.05), 0 3px 6px rgba(43, 149, 236, 0.1);
        }

        .btn:hover::before {
            opacity: 1;
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn i {
            font-size: 1rem;
            transition: transform 0.3s ease;
        }

        .btn:hover i {
            transform: scale(1.2);
        }

        .btn-primary {
            background: var(--primary-gradient);
            color: white;
        }

        .btn-secondary {
            background: var(--secondary-color);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success-color), #2CC990);
            color: white;
        }

        .btn-info {
            background: linear-gradient(135deg, var(--accent-color), #3DCEE9);
            color: var(--text-primary);
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning-color), #F7A93B);
            color: var(--text-primary);
        }

        /* 进度条样式 */
        .progress-container {
            margin-bottom: 2rem;
        }

        .progress {
            height: 12px;
            border-radius: calc(var(--border-radius) / 2);
            background: rgba(255, 255, 255, 0.3);
            overflow: hidden;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .progress-bar {
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
            box-shadow: 0 0 10px rgba(43, 149, 236, 0.4);
            transition: width 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            overflow: hidden;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(
                90deg,
                rgba(255, 255, 255, 0) 0%,
                rgba(255, 255, 255, 0.4) 50%,
                rgba(255, 255, 255, 0) 100%
            );
            width: 50%;
            animation: progressShine 2s infinite;
        }

        @keyframes progressShine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(200%); }
        }

        #progress-text {
            font-weight: 600;
            color: var(--secondary-color);
        }

        /* 表格样式优化 */
        .table-responsive {
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--card-shadow-sm);
            margin-top: 2rem;
            background: var(--surface-color);
            backdrop-filter: blur(var(--blur-effect));
            border: 1px solid rgba(255, 255, 255, 0.6);
        }

        .table {
            margin-bottom: 0;
        }

        .table th {
            background: rgba(43, 149, 236, 0.04);
            color: var(--secondary-dark);
            font-family: var(--font-secondary);
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 0.05em;
            padding: 1rem;
            vertical-align: middle;
            border-bottom: 2px solid rgba(43, 149, 236, 0.1);
        }

        .table td {
            padding: 0.75rem 1rem;
            vertical-align: middle;
            border-bottom: 1px solid rgba(43, 149, 236, 0.05);
            transition: all var(--transition-speed);
            word-wrap: break-word;
            word-break: break-all;
            white-space: normal;
            max-width: 300px;
        }

        .table tr:hover td {
            background: rgba(43, 149, 236, 0.02);
        }

        .success {
            background-color: rgba(46, 224, 160, 0.06) !important;
            border-left: 3px solid var(--success-color);
        }

        .error {
            background-color: rgba(255, 107, 107, 0.06) !important;
            border-left: 3px solid var(--error-color);
        }

        .positive-balance {
            background-color: rgba(46, 224, 160, 0.1) !important;
            border-left: 3px solid var(--success-color);
        }

        .zero-negative-balance {
            background-color: rgba(255, 190, 61, 0.1) !important;
            border-left: 3px solid var(--warning-color);
        }

        .badge {
            padding: 0.5em 0.75em;
            border-radius: var(--border-radius-sm);
            font-weight: 500;
            font-size: 0.75rem;
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
        }

        .bg-success {
            background: var(--success-color) !important;
        }

        .bg-danger {
            background: var(--error-color) !important;
        }

        /* 浮动按钮样式 */
        .floating-buttons {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            z-index: 1000;
        }

        .floating-buttons button {
            width: 3.5rem;
            height: 3.5rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--card-shadow);
            opacity: 0.8;
            transition: all var(--transition-speed) cubic-bezier(0.34, 1.56, 0.64, 1);
            background: var(--surface-color);
            backdrop-filter: blur(var(--blur-effect));
            border: 1px solid rgba(255, 255, 255, 0.6);
        }

        .floating-buttons button:hover {
            opacity: 1;
            transform: scale(1.15);
            box-shadow: var(--card-shadow-lg);
        }

        .floating-buttons button i {
            color: var(--primary-dark);
            font-size: 1.2rem;
        }

        /* 开关样式 */
        .form-check-input {
            width: 2.5rem;
            height: 1.25rem;
            border-radius: 2rem;
            background-color: rgba(43, 149, 236, 0.2);
            border: none;
            appearance: none;
            cursor: pointer;
            position: relative;
            transition: all var(--transition-speed);
        }

        .form-check-input:checked {
            background-color: var(--primary-color);
        }

        .form-check-input::before {
            content: '';
            position: absolute;
            height: 0.9rem;
            width: 0.9rem;
            left: 0.2rem;
            bottom: 0.175rem;
            background-color: white;
            border-radius: 50%;
            transition: all var(--transition-speed);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        .form-check-input:checked::before {
            transform: translateX(1.3rem);
            background-color: white;
        }

        .form-check-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
            cursor: pointer;
            user-select: none;
        }

        /* 辅助动画效果 */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(43, 149, 236, 0.6); }
            70% { box-shadow: 0 0 0 10px rgba(43, 149, 236, 0); }
            100% { box-shadow: 0 0 0 0 rgba(43, 149, 236, 0); }
        }

        /* 响应式调整 */
        @media (max-width: 768px) {
            .main-container {
                margin: 1.5rem;
                padding: 1.5rem;
            }

            .header {
                padding: 1.5rem 1rem;
            }

            .stats-container {
                grid-template-columns: repeat(2, 1fr);
            }

            .action-buttons {
                justify-content: center;
            }

            .btn {
                padding: 0.6rem 1rem;
                font-size: 0.9rem;
            }
        }

        @media (max-width: 480px) {
            .stats-container {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                flex-direction: column;
                align-items: stretch;
            }

            .floating-buttons {
                bottom: 1rem;
                right: 1rem;
            }

            .floating-buttons button {
                width: 3rem;
                height: 3rem;
            }
        }

        /* 兼容性处理 */
        @supports not (backdrop-filter: blur(15px)) {
            .main-container,
            .table-responsive,
            .floating-buttons button {
                background: rgba(255, 255, 255, 0.95);
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="header">
            <div class="svg-container">
                <!-- SVG路径动画效果 -->
                <svg width="100%" height="100%" viewBox="0 0 800 300" xmlns="http://www.w3.org/2000/svg">
                    <path class="header-svg-path" d="M50,150 C150,50 250,250 350,150 C450,50 550,250 650,150 C750,50 850,250 950,150" 
                          fill="none" stroke="white" stroke-width="8" />
                    <path class="header-svg-path" d="M50,100 C150,200 250,0 350,100 C450,200 550,0 650,100 C750,200 850,0 950,100" 
                          fill="none" stroke="white" stroke-width="5" style="animation-delay: 0.5s" />
                    <path class="header-svg-path" d="M50,200 C150,100 250,300 350,200 C450,100 550,300 650,200 C750,100 850,300 950,200" 
                          fill="none" stroke="white" stroke-width="3" style="animation-delay: 1s" />
                </svg>
            </div>
            <h1><i class="fas fa-key"></i> API密钥批量检测工具</h1>
            <p class="mb-0">快速检测多个API密钥的有效性和详细信息</p>
        </div>

        <div class="stats-container">
            <div class="stat-card">
                <h5><i class="fas fa-list"></i> 总计检测</h5>
                <h3 id="total-count">0</h3>
            </div>
            <div class="stat-card">
                <h5><i class="fas fa-check-circle"></i> 成功数量</h5>
                <h3 id="success-count" style="color: var(--success-color)">0</h3>
            </div>
            <div class="stat-card">
                <h5><i class="fas fa-times-circle"></i> 失败数量</h5>
                <h3 id="fail-count" style="color: var(--error-color)">0</h3>
            </div>
            <div class="stat-card">
                <h5><i class="fas fa-percentage"></i> 成功率</h5>
                <h3 id="success-rate">0%</h3>
            </div>
        </div>

        <div class="input-group">
            <textarea class="form-control" id="apiKeys" rows="6" placeholder="在此粘贴要检测的API密钥..." aria-label="API密钥输入区"></textarea>
            <button class="btn file-upload-btn" type="button" onclick="document.getElementById('fileInput').click()" aria-label="导入文件">
                <i class="fas fa-upload"></i> 导入文件
            </button>
            <input type="file" id="fileInput" style="display: none;" accept=".txt, .csv, .json" onchange="handleFileImport(this.files)">
        </div>

        <div class="action-buttons">
            <button class="btn btn-primary" onclick="startTest()" aria-label="开始检测">
                <i class="fas fa-play"></i> 开始检测
            </button>
            <button class="btn btn-secondary" id="pauseButton" onclick="pauseTest()" disabled aria-label="暂停检测">
                <i class="fas fa-pause"></i> 暂停检测
            </button>
            <button class="btn btn-success" onclick="exportToExcel()" aria-label="导出Excel">
                <i class="fas fa-file-excel"></i> 导出Excel
            </button>
            <button class="btn btn-info" onclick="copySuccessKeys()" aria-label="复制有效密钥">
                <i class="fas fa-copy"></i> 复制有效密钥
            </button>
            <button class="btn btn-success" onclick="copyPositiveBalanceKeys()" aria-label="复制正余额密钥">
                <i class="fas fa-copy"></i> 复制正余额密钥
            </button>
            <button class="btn btn-warning" onclick="copyZeroOrNegativeBalanceKeys()" aria-label="复制零/负余额密钥">
                <i class="fas fa-copy"></i> 复制零/负余额密钥
            </button>
            <button class="btn btn-warning" onclick="clearResults()" aria-label="清除结果">
                <i class="fas fa-trash"></i> 清除结果
            </button>
        </div>

        <div class="progress-container">
            <div class="d-flex justify-content-between mb-2">
                <span>检测进度</span>
                <span id="progress-text">0/0</span>
            </div>
            <div class="progress" role="progressbar" aria-label="检测进度条">
                <div id="progress" class="progress-bar" style="width: 0%"></div>
            </div>
        </div>

        <div class="table-responsive">
            <table class="table table-bordered table-hover">
                <thead>
                    <tr>
                        <th scope="col">序号</th>
                        <th scope="col">密钥</th>
                        <th scope="col">状态</th>
                        <th scope="col">用户ID</th>
                        <th scope="col">用户名</th>
                        <th scope="col">邮箱</th>
                        <th scope="col">管理员权限</th>
                        <th scope="col">账户状态</th>
                        <th scope="col">基础余额</th>
                        <th scope="col">充值余额</th>
                        <th scope="col">总余额</th>
                    </tr>
                </thead>
                <tbody id="results"></tbody>
            </table>
        </div>
    </div>

    <div class="floating-buttons">
        <button class="btn" onclick="scrollToTop()" title="返回顶部" aria-label="返回顶部">
            <i class="fas fa-arrow-up"></i>
        </button>
        <button class="btn" onclick="scrollToBottom()" title="滚动到底部" aria-label="滚动到底部">
            <i class="fas fa-arrow-down"></i>
        </button>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.17.0/dist/xlsx.full.min.js"></script>

    <script>
        let successCount = 0;
        let failCount = 0;
        let keys = [];
        let currentKeyIndex = 0;
        let isPaused = false;
        let positiveBalanceKeys = [];
        let zeroOrNegativeBalanceKeys = [];
        const pauseButton = document.getElementById('pauseButton');

        // 页面加载完成后执行的初始动画效果
        document.addEventListener('DOMContentLoaded', function() {
            const statCards = document.querySelectorAll('.stat-card');
            statCards.forEach((card, index) => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';
                setTimeout(() => {
                    card.style.transition = 'all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1)';
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                }, 100 * index);
            });
        });

        async function testApiKey(apiKey, retryCount = 0) {
            const maxRetries = 3;
            try {
                const response = await fetch('https://api.siliconflow.cn/v1/user/info', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`
                    }
                });
                const data = await response.json();
                return {
                    success: response.ok,
                    data: data
                };
            } catch (error) {
                if (retryCount < maxRetries) {
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    return testApiKey(apiKey, retryCount + 1);
                }
                return {
                    success: false,
                    error: error.message
                };
            }
        }

        async function processKeys() {
            const total = keys.length;

            if (total === 0 || currentKeyIndex >= total || isPaused) {
                if(isPaused) {
                    pauseButton.innerHTML = '<i class="fas fa-play"></i> 继续检测';
                    pauseButton.classList.remove('btn-secondary');
                    pauseButton.classList.add('btn-primary');
                } else if (total > 0) {
                    Swal.fire({
                        icon: 'success',
                        title: '检测完成',
                        text: `成功: ${successCount} 失败: ${failCount}`,
                        background: 'var(--surface-color)',
                        backdrop: `rgba(43, 149, 236, 0.4)`,
                        confirmButtonColor: 'var(--primary-color)'
                    });
                }
                return;
            }
            pauseButton.disabled = false;

            const key = keys[currentKeyIndex].trim();
            if(key){
                const result = await testApiKey(key);
                updateProgress(currentKeyIndex + 1, total);

                if (result.success && result.data.status) {
                    successCount++;
                    const userData = result.data.data;
                    addResultRow(currentKeyIndex + 1, key, {
                        status: '成功',
                        userId: userData.id,
                        name: userData.name,
                        email: userData.email,
                        isAdmin: userData.isAdmin ? '是' : '否',
                        status: userData.status,
                        balance: userData.balance,
                        chargeBalance: userData.chargeBalance,
                        totalBalance: userData.totalBalance
                    }, true);
                } else {
                    failCount++;
                    addResultRow(currentKeyIndex + 1, key, {
                        status: '失败',
                        error: result.error || result.data.message
                    }, false);
                }

                updateStats();
            }

            currentKeyIndex++;
            if (!isPaused) {
                processKeys();
            }
        }

        function addResultRow(index, key, data, success) {
            const tbody = document.getElementById('results');
            const row = document.createElement('tr');
            row.className = success ? 'success' : 'error';
            row.style.opacity = '0';
            row.style.transform = 'translateY(10px)';

            if (success) {
                // 计算总余额
                const totalBalance = parseFloat(data.totalBalance);
                
                // 根据余额分类
                if (totalBalance > 0) {
                    positiveBalanceKeys.push(key);
                    row.classList.add('positive-balance');
                } else {
                    zeroOrNegativeBalanceKeys.push(key);
                    row.classList.add('zero-negative-balance');
                }

                row.innerHTML = `
                    <td>${index}</td>
                    <td>${key}</td>
                    <td><span class="badge bg-success"><i class="fas fa-check-circle"></i> 成功</span></td>
                    <td>${data.userId}</td>
                    <td>${data.name}</td>
                    <td>${data.email}</td>
                    <td>${data.isAdmin}</td>
                    <td>${data.status}</td>
                    <td>${data.balance}</td>
                    <td>${data.chargeBalance}</td>
                    <td>${data.totalBalance}</td>
                `;
            } else {
                row.innerHTML = `
                    <td>${index}</td>
                    <td>${key}</td>
                    <td colspan="9"><span class="badge bg-danger"><i class="fas fa-times-circle"></i> 失败</span> ${data.error || '未知错误'}</td>
                `;
            }

            tbody.appendChild(row);
            
            // 添加淡入动画效果
            setTimeout(() => {
                row.style.transition = 'all 0.5s ease';
                row.style.opacity = '1';
                row.style.transform = 'translateY(0)';
            }, 50);
        }

        function copyPositiveBalanceKeys() {
            if (positiveBalanceKeys.length > 0) {
                const keysText = positiveBalanceKeys.join('\n');
                navigator.clipboard.writeText(keysText).then(() => {
                    Swal.fire({
                        icon: 'success',
                        title: '复制成功',
                        text: `已复制${positiveBalanceKeys.length}个正余额密钥`,
                        toast: true,
                        position: 'top-end',
                        showConfirmButton: false,
                        timer: 3000,
                        background: 'var(--surface-color)',
                        iconColor: 'var(--success-color)'
                    });
                });
            } else {
                Swal.fire({
                    icon: 'info',
                    title: '没有正余额密钥',
                    text: '当前没有检测到正余额的API密钥',
                    toast: true,
                    position: 'top-end',
                    showConfirmButton: false,
                    timer: 3000,
                    background: 'var(--surface-color)',
                    confirmButtonColor: 'var(--primary-color)'
                });
            }
        }

        function copyZeroOrNegativeBalanceKeys() {
            if (zeroOrNegativeBalanceKeys.length > 0) {
                const keysText = zeroOrNegativeBalanceKeys.join('\n');
                navigator.clipboard.writeText(keysText).then(() => {
                    Swal.fire({
                        icon: 'success',
                        title: '复制成功',
                        text: `已复制${zeroOrNegativeBalanceKeys.length}个零/负余额密钥`,
                        toast: true,
                        position: 'top-end',
                        showConfirmButton: false,
                        timer: 3000,
                        background: 'var(--surface-color)',
                        iconColor: 'var(--success-color)'
                    });
                });
            } else {
                Swal.fire({
                    icon: 'info',
                    title: '没有零/负余额密钥',
                    text: '当前没有检测到零或负余额的API密钥',
                    toast: true,
                    position: 'top-end',
                    showConfirmButton: false,
                    timer: 3000,
                    background: 'var(--surface-color)',
                    confirmButtonColor: 'var(--primary-color)'
                });
            }
        }

        async function startTest() {
            const textarea = document.getElementById('apiKeys');
            keys = textarea.value.split('\n').filter(key => key.trim());

            if (keys.length === 0) {
                Swal.fire({
                    icon: 'warning',
                    title: '请输入API密钥',
                    text: '请在文本框中输入至少一个API密钥',
                    toast: true,
                    position: 'top-end',
                    showConfirmButton: false,
                    timer: 3000,
                    background: 'var(--surface-color)',
                    confirmButtonColor: 'var(--primary-color)'
                });
                return;
            }

            // 添加开始测试的视觉反馈
            Swal.fire({
                icon: 'info',
                title: '开始检测',
                text: `即将开始检测${keys.length}个API密钥`,
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 3000,                
                background: 'var(--surface-color)',
                didOpen: () => {
                    Swal.showLoading();
                }
            }).then(() => {
                isPaused = false;
                currentKeyIndex = 0;
                successCount = 0;
                failCount = 0;
                positiveBalanceKeys = [];
                zeroOrNegativeBalanceKeys = [];
                document.getElementById('results').innerHTML = '';
                updateStats();
                pauseButton.disabled = false;
                pauseButton.innerHTML = '<i class="fas fa-pause"></i> 暂停检测';
                pauseButton.classList.remove('btn-primary');
                pauseButton.classList.add('btn-secondary');
                processKeys();
            });
        }

        function pauseTest() {
            isPaused = !isPaused;
            if (isPaused) {
                pauseButton.innerHTML = '<i class="fas fa-play"></i> 继续检测';
                pauseButton.classList.remove('btn-secondary');
                pauseButton.classList.add('btn-primary');
                
                // 暂停反馈
                Swal.fire({
                    icon: 'info',
                    title: '已暂停',
                    text: '检测已暂停，点击"继续检测"以恢复',
                    toast: true,
                    position: 'top-end',
                    showConfirmButton: false,
                    timer: 3000,
                    background: 'var(--surface-color)',
                    iconColor: 'var(--primary-color)'
                });
            } else {
                pauseButton.innerHTML = '<i class="fas fa-pause"></i> 暂停检测';
                pauseButton.classList.remove('btn-primary');
                pauseButton.classList.add('btn-secondary');
                processKeys();
                
                // 继续反馈
                Swal.fire({
                    icon: 'success',
                    title: '已继续',
                    text: '检测继续进行',
                    toast: true,
                    position: 'top-end',
                    showConfirmButton: false,
                    timer: 2000,
                    background: 'var(--surface-color)',
                    iconColor: 'var(--primary-color)'
                });
            }
        }

        function updateProgress(completed, total) {
            const percentage = (completed / total) * 100;
            const progressBar = document.getElementById('progress');
            progressBar.style.width = `${percentage}%`;
            document.getElementById('progress-text').textContent = `${completed}/${total}`;
        }

        function updateStats() {
            const total = successCount + failCount;
            const successRate = total > 0 ? Math.round((successCount / total) * 100) : 0;
            
            document.getElementById('total-count').textContent = total;
            document.getElementById('success-count').textContent = successCount;
            document.getElementById('fail-count').textContent = failCount;
            document.getElementById('success-rate').textContent = `${successRate}%`;
            
            // 如果成功率变化，添加视觉效果
            const successRateElement = document.getElementById('success-rate');
            successRateElement.classList.add('pulse-animation');
            setTimeout(() => {
                successRateElement.classList.remove('pulse-animation');
            }, 1000);
        }

        function clearResults() {
            Swal.fire({
                title: '确认清除?',
                text: "此操作将清除所有检测结果!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: 'var(--primary-color)',
                cancelButtonColor: 'var(--error-color)',
                confirmButtonText: '确定',
                cancelButtonText: '取消',
                background: 'var(--surface-color)'
            }).then((result) => {
                if (result.isConfirmed) {
                    document.getElementById('results').innerHTML = '';
                    document.getElementById('progress').style.width = '0%';
                    document.getElementById('progress-text').textContent = '0/0';
                    document.getElementById('apiKeys').value = '';
                    successCount = 0;
                    failCount = 0;
                    positiveBalanceKeys = [];
                    zeroOrNegativeBalanceKeys = [];
                    updateStats();
                    isPaused = false;
                    pauseButton.disabled = true;
                    pauseButton.innerHTML = '<i class="fas fa-pause"></i> 暂停检测';
                    pauseButton.classList.remove('btn-primary');
                    pauseButton.classList.add('btn-secondary');
                    
                    Swal.fire({
                        icon: 'success',
                        title: '已清除!',
                        text: '所有检测结果已被清除',
                        toast: true,
                        position: 'top-end',
                        showConfirmButton: false,
                        timer: 3000,
                        background: 'var(--surface-color)',
                        confirmButtonColor: 'var(--primary-color)'
                    });
                }
            });
        }

        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }

        function scrollToBottom() {
            window.scrollTo({
                top: document.documentElement.scrollHeight,
                behavior: 'smooth'
            });
        }

        function handleFileImport(files) {
            if (files.length === 0) return;
            
            const file = files[0];
            const reader = new FileReader();
            
            // 添加导入文件的视觉反馈
            Swal.fire({
                title: '正在导入...',
                text: `正在处理文件: ${file.name}`,
                didOpen: () => {
                    Swal.showLoading();
                },
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 3000,
                background: 'var(--surface-color)',
                allowOutsideClick: false,
                allowEscapeKey: false,
                showConfirmButton: false
            });
            
            reader.onload = function(e) {
                const content = e.target.result;
                document.getElementById('apiKeys').value = content;
                
                Swal.fire({
                    icon: 'success',
                    title: '导入成功',
                    text: `已成功导入文件: ${file.name}`,
                    toast: true,
                    position: 'top-end',
                    showConfirmButton: false,
                    timer: 3000,
                    background: 'var(--surface-color)',
                    iconColor: 'var(--success-color)'
                });
            };
            
            reader.onerror = function() {
                Swal.fire({
                    icon: 'error',
                    title: '导入失败',
                    text: '读取文件时发生错误',
                    toast: true,
                    position: 'top-end',
                    showConfirmButton: false,
                    timer: 3000,
                    background: 'var(--surface-color)',
                    confirmButtonColor: 'var(--primary-color)'
                });
            };
            
            reader.readAsText(file);
        }

        function copySuccessKeys() {
            const rows = document.querySelectorAll('.success');
            const successKeys = Array.from(rows).map(row => row.children[1].textContent.trim()).join('\n');

            if (successKeys) {
                navigator.clipboard.writeText(successKeys).then(() => {
                    Swal.fire({
                        icon: 'success',
                        title: '复制成功',
                        text: `已复制${rows.length}个有效的API密钥`,
                        toast: true,
                        position: 'top-end',
                        showConfirmButton: false,
                        timer: 3000,
                        background: 'var(--surface-color)',
                        iconColor: 'var(--success-color)'
                    });
                });
            } else {
                Swal.fire({
                    icon: 'info',
                    title: '没有有效密钥',
                    text: '当前没有检测到有效的API密钥',
                    toast: true,
                    position: 'top-end',
                    showConfirmButton: false,
                    timer: 3000,
                    background: 'var(--surface-color)',
                    confirmButtonColor: 'var(--primary-color)'
                });
            }
        }

        function exportToExcel() {
            const table = document.querySelector('table');
            const rows = table.querySelectorAll('tbody tr');
            
            if (rows.length === 0) {
                Swal.fire({
                    icon: 'warning',
                    title: '没有数据',
                    text: '没有可导出的检测结果',
                    toast: true,
                    position: 'top-end',
                    showConfirmButton: false,
                    timer: 3000,
                    background: 'var(--surface-color)',
                    confirmButtonColor: 'var(--primary-color)'
                });
                return;
            }
            
            // 显示导出进度
            Swal.fire({
                title: '正在导出...',
                text: '正在生成Excel文件',
                didOpen: () => {
                    Swal.showLoading();
                },
                timer: 3000,
                background: 'var(--surface-color)',
                allowOutsideClick: false,
                allowEscapeKey: false,
                showConfirmButton: false
            });
            
            setTimeout(() => {
                try {
                    const ws = XLSX.utils.table_to_sheet(table);
                    const wb = XLSX.utils.book_new();
                    XLSX.utils.book_append_sheet(wb, ws, "检测结果");

                    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
                    const fileName = `API密钥检测结果_${timestamp}.xlsx`;

                    XLSX.writeFile(wb, fileName);
                    
                    Swal.fire({
                        icon: 'success',
                        title: '导出成功',
                        text: `文件已保存为: ${fileName}`,
                        toast: true,
                        position: 'top-end',
                        showConfirmButton: false,
                        timer: 3000,
                        background: 'var(--surface-color)',
                        confirmButtonColor: 'var(--primary-color)'
                    });
                } catch (error) {
                    Swal.fire({
                        icon: 'error',
                        title: '导出失败',
                        text: '导出Excel文件时发生错误',
                        toast: true,
                        position: 'top-end',
                        showConfirmButton: false,
                        timer: 3000,
                        background: 'var(--surface-color)',
                        confirmButtonColor: 'var(--primary-color)'
                    });
                    console.error('导出错误:', error);
                }
            }, 800);
        }

        // 添加键盘快捷键支持
        document.addEventListener('keydown', function(e) {          
            // 添加 Ctrl + O 导入文件的快捷键
            if (e.ctrlKey && e.key === 'o') {
            document.getElementById('fileInput').click();
            e.preventDefault();

    }       // Ctrl + Enter 开始检测
            if (e.ctrlKey && e.key === 'Enter') {
                startTest();
                e.preventDefault();
            }
            
            // Esc 清除结果
            if (e.key === 'Escape') {
                clearResults();
                e.preventDefault();
            }
            
            // Ctrl + S 导出Excel
            if (e.ctrlKey && e.key === 's') {
                exportToExcel();
                e.preventDefault();
            }
            
            // Ctrl + Space 暂停/继续
            if (e.ctrlKey && e.key === ' ' && !pauseButton.disabled) {
                pauseTest();
                e.preventDefault();
            }
        });

        // 添加页面可见性变化处理，在页面不可见时暂停处理
        document.addEventListener('visibilitychange', function() {
            if (document.visibilityState === 'hidden' && !isPaused && currentKeyIndex < keys.length && currentKeyIndex > 0) {
                // 页面不可见时自动暂停
                isPaused = true;
                pauseButton.innerHTML = '<i class="fas fa-play"></i> 继续检测';
                pauseButton.classList.remove('btn-secondary');
                pauseButton.classList.add('btn-primary');
            }
        });
    </script>
</body>
</html>
